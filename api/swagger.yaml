# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# Swagger Specification for Patient Match Test Harness
#
# Copyright (c) 2016.  The MITRE Corporation. All rights reserved.
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
swagger: '2.0'

# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#                  API Information
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
info:
  version: "0.1.0"
  title: Patient Match Test Harness REST API
  description: |
    The vertical bar seems to denote a multi-line entry
    that is "magically" terminated by the next field name.
    Note that __Markdown is supported__ in the text field.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0

# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#   Host, service Base Path, Schemes and Content Types
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#host: api.instagram.com
schemes:
  - http
  - https
produces:
  - application/json
consumes:
  - application/json

# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#           Paths
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
paths:
  /AnswerKey:
    post:
      operationId: setAnswerKey
      summary: Set Answer Key
      tags:
        - RecordSet
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: recordSetId
          in: formData
          description: Identifier of record set with which to associate the answer key
          required: true
          type: string
        - name: answerKey
          in: formData
          description: uploaded FHIR Bundle of type  Document as a JSON file that represents the answer key.  The file content is an [AnswerKeyBundle](#/definitions/AnswerKeyBundle)
          required: true
          type: file
      responses:
        200:
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/RecordSet'
        400:
          description: Bad Request
        404:
          description: Not Found
        500:
          description: Internal Server Error

  /RecordMatchContext:
    get:
      operationId: getRecordMatchContexts
      summary: Get Record Match Contexts
      tags:
        - RecordMatchContext
      description: |
        Returns collection of `RecordMatchContext` objects.
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchContext'
        400:
          description: Bad Request
        404:
          description: Not Found
    post:
      operationId: createRecordMatchContext
      summary: Create Record Match Context
      tags:
        - RecordMatchContext
      parameters:
        - name: recordMatchContext
          in: body
          description: Record Match Context to add
          required: true
          schema:
            $ref: '#/definitions/RecordMatchContextBase'
      responses:
        201:
          description: Resource Created
        400:
          description: Bad Request
        500:
          description: Internal Server Error


  /RecordMatchContext/{id}:
    get:
      operationId: getRecordMatchContextById
      summary: Get one Record Match Context by Id
      tags:
        - RecordMatchContext
      parameters:
        - name: id
          in: path
          description: Identifier of resource to fetch
          required: true
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchContext'
        400:
          description: Bad Request
        404:
          description: Not Found
    put:
      operationId: updateRecordMatchContext
      summary: Update Record Match Context
      tags:
        - RecordMatchContext
      parameters:
        - name: id
          in: path
          description: Identifier of resource to update
          required: true
          type: string
        - name: recordMatchContext
          in: body
          description: Record Match Context to update
          required: true
          schema:
            $ref: '#/definitions/RecordMatchContextBase'
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchContext'
        400:
          description: Bad Request
        500:
          description: Internal Server Error
    delete:
      operationId: deleteRecordMatchContext
      summary: Delete Record Match Context
      tags:
        - RecordMatchContext
      parameters:
        - name: id
          in: path
          description: Identifier of resource to delete
          required: true
          type: string
      responses:
        204:
          description: No Content
        500:
          description: Internal Server Error

  /RecordMatchRun:
    get:
      operationId: getRecordMatchRuns
      summary: Get Record Match Runs
      tags:
        - RecordMatchRun
      responses:
        200:
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/RecordMatchRun'
            example:
            - id: 5746f0aea291023b0db67632
              meta:
                createdOn: '2016-05-26T08:48:46.713-04:00'
                lastUpdatedOn: '0001-01-01T00:00:00Z'
              recordMatchContextId: 5746e836a291023b0db67629
              request:
                id: 5746f0aea291023b0db67630
                meta:
                  createdOn: '2016-05-26T08:48:46.709-04:00'
                  lastUpdatedOn: '0001-01-01T00:00:00Z'
                message:
                  resourceType: Bundle
                  id: 5746f0aea291023b0db67631
                  type: message
                  entry:
                    - fullUrl: 'urn:uuid:c0bd82da-ae27-48bd-bf92-841db6d55e92'
                      resource:
                        _id: c0bd82da-ae27-48bd-bf92-841db6d55e92
                        data:
                          - reference: 'urn:uuid:8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1'
                        destination:
                          - endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: FRIL - Equal Weight - Accept 60
                        event:
                          code: record-match
                          system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                        resourceType: MessageHeader
                        source:
                          endpoint: 'http://mitre.org/ptmatch'
                        timestamp:
                          precision: timestamp
                          time: '2016-05-26T08:48:46.703-04:00'
                    - fullUrl: 'urn:uuid:8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1'
                      resource:
                        _id: 8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1
                        parameter:
                          - name: type
                            valueString: master
                          - name: resourceType
                            valueString: Patient
                          - name: searchExpression
                            resource:
                              parameter:
                                - name: resourceUrl
                                  valueString: 'http://localhost:3001/Patient'
                                - name: gender
                                  valueString: MALE
                                - name: address-city
                                  valueString: Grand Rapids
                                - name: address-state
                                  valueString: MI
                              resourceType: Parameters
                        resourceType: Parameters
                submittedOn: '0001-01-01T00:00:00Z'
              responses:
                - id: 5746f0cba7fc203dc7e46428
                  meta:
                    createdOn: '2016-05-26T08:49:15.679-04:00'
                    lastUpdatedOn: '2016-05-26T08:49:15.679-04:00'
                  message:
                    resourceType: Bundle
                    id: 5746f0cba7fc203dc7e46428
                    meta:
                      lastUpdated: '2016-05-26T08:49:15-04:00'
                    type: message
                    entry:
                      - fullUrl: 687fd9dd-2d06-4936-a0af-71c8ede80268
                        resource:
                          _id: 5746f0cba7fc203dc7e46429
                          destination:
                            - endpoint: 'http://mitre.org/ptmatch'
                          event:
                            code: record-match
                            system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                          resourceType: MessageHeader
                          response:
                            code: ok
                            identifier: c0bd82da-ae27-48bd-bf92-841db6d55e92
                          source:
                            endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: ptmatchAdapter-fril
                          timestamp:
                            precision: timestamp
                            time: '2016-05-26T08:49:15.581-04:00'
                  receivedOn: '2016-05-26T08:49:15.679-04:00'
                - id: 5746f0cba7fc203dc7e4642a
                  meta:
                    createdOn: '2016-05-26T08:49:15.774-04:00'
                    lastUpdatedOn: '2016-05-26T08:49:15.774-04:00'
                  message:
                    resourceType: Bundle
                    id: 5746f0cba7fc203dc7e4642a
                    meta:
                      lastUpdated: '2016-05-26T08:49:15-04:00'
                    type: message
                    entry:
                      - fullUrl: 'urn:uuid:8f9a03c7-ccd7-4f19-b3c4-fb75c9f8559d'
                        resource:
                          _id: 5746f0cba7fc203dc7e4642b
                          data:
                            - external: false
                              reference: 'urn:uuid:8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1'
                          destination:
                            - endpoint: 'http://mitre.org/ptmatch'
                          event:
                            code: record-match
                            system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                          resourceType: MessageHeader
                          response:
                            code: fatal-error
                            identifier: c0bd82da-ae27-48bd-bf92-841db6d55e92
                          source:
                            endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: FRIL - Equal Weight - Accept 60
                          timestamp:
                            precision: timestamp
                            time: '2016-05-26T08:49:15.66-04:00'
                      - fullUrl: 'urn:uuid:00428457-13a6-45ea-8a12-43ebb7ad945b'
                        resource:
                          _id: 5746f0cba7fc203dc7e4642c
                          issue:
                            - code: informational
                              diagnostics: 'Error response from server.  code: 500, HTTP 500 Internal Server Error: '
                              severity: information
                          resourceType: OperationOutcome
                      - fullUrl: 'urn:uuid:8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1'
                        resource:
                          _id: 8d2ca990-bbcf-4275-8de8-7cf1cf93c8b1
                          parameter:
                            - name: type
                              valueString: master
                            - name: resourceType
                              valueString: Patient
                            - name: searchExpression
                              resource:
                                parameter:
                                  - name: resourceUrl
                                    valueString: 'http://localhost:3001/Patient'
                                  - name: gender
                                    valueString: MALE
                                  - name: address-city
                                    valueString: Grand Rapids
                                  - name: address-state
                                    valueString: MI
                                resourceType: Parameters
                          resourceType: Parameters
                  receivedOn: '2016-05-26T08:49:15.774-04:00'
              metrics: {}
              status:
                - message: 'Request Sent [201 Created]'
                  createdOn: '2016-05-26T08:48:46.712-04:00'
                - message: 'Response Received [5746f0cba7fc203dc7e46428]'
                  createdOn: '2016-05-26T08:49:15.679-04:00'
                - message: 'Metrics Updated [5746f0cba7fc203dc7e46428]'
                  createdOn: '2016-05-26T08:49:15.699-04:00'
                - message: 'Response Received [5746f0cba7fc203dc7e4642a]'
                  createdOn: '2016-05-26T08:49:15.774-04:00'
                - message: 'Metrics Updated [5746f0cba7fc203dc7e4642a]'
                  createdOn: '2016-05-26T08:49:15.788-04:00'
              matchingMode: deduplication
              recordMatchSystemInterfaceId: 572b66a7a291021cbcb5e0fa
              masterRecordSetId: 572b66b8a291021cbcb5e0fb
            - id: 57502376a29102405f406255
              meta:
                createdOn: '2016-06-02T08:15:50.726-04:00'
                lastUpdatedOn: '0001-01-01T00:00:00Z'
              recordMatchContextId: 5746e836a291023b0db67629
              request:
                id: 57502376a29102405f406253
                meta:
                  createdOn: '2016-06-02T08:15:50.636-04:00'
                  lastUpdatedOn: '0001-01-01T00:00:00Z'
                message:
                  resourceType: Bundle
                  id: 57502376a29102405f406254
                  type: message
                  entry:
                    - fullUrl: 'urn:uuid:64af6aa4-0321-4516-843b-6d4514a56d3d'
                      resource:
                        _id: 64af6aa4-0321-4516-843b-6d4514a56d3d
                        data:
                          - reference: 'urn:uuid:ff483dfa-b959-4eff-8751-6c09634d27d4'
                        destination:
                          - endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: FRIL - Equal Weight - Accept 60
                        event:
                          code: record-match
                          system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                        resourceType: MessageHeader
                        source:
                          endpoint: 'http://mitre.org/ptmatch'
                        timestamp:
                          precision: timestamp
                          time: '2016-06-02T08:15:50.598-04:00'
                    - fullUrl: 'urn:uuid:ff483dfa-b959-4eff-8751-6c09634d27d4'
                      resource:
                        _id: ff483dfa-b959-4eff-8751-6c09634d27d4
                        parameter:
                          - name: type
                            valueString: master
                          - name: resourceType
                            valueString: Patient
                          - name: searchExpression
                            resource:
                              parameter:
                                - name: resourceUrl
                                  valueString: 'http://localhost:3001/Patient'
                                - name: gender
                                  valueString: MALE
                                - name: address-city
                                  valueString: Grand Rapids
                                - name: address-state
                                  valueString: MI
                              resourceType: Parameters
                        resourceType: Parameters
                submittedOn: '0001-01-01T00:00:00Z'
              responses:
                - id: 5750238da7fc204288bba7f5
                  meta:
                    createdOn: '2016-06-02T08:16:13.432-04:00'
                    lastUpdatedOn: '2016-06-02T08:16:13.432-04:00'
                  message:
                    resourceType: Bundle
                    id: 5750238da7fc204288bba7f5
                    meta:
                      lastUpdated: '2016-06-02T08:16:13-04:00'
                    type: message
                    entry:
                      - fullUrl: 47e20619-7c2d-49ff-9142-537977288b40
                        resource:
                          _id: 5750238da7fc204288bba7f6
                          destination:
                            - endpoint: 'http://mitre.org/ptmatch'
                          event:
                            code: record-match
                            system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                          resourceType: MessageHeader
                          response:
                            code: ok
                            identifier: 64af6aa4-0321-4516-843b-6d4514a56d3d
                          source:
                            endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: ptmatchAdapter-fril
                          timestamp:
                            precision: timestamp
                            time: '2016-06-02T08:16:13.296-04:00'
                  receivedOn: '2016-06-02T08:16:13.432-04:00'
                - id: 5750238ea7fc204288bba7f7
                  meta:
                    createdOn: '2016-06-02T08:16:14.381-04:00'
                    lastUpdatedOn: '2016-06-02T08:16:14.381-04:00'
                  message:
                    resourceType: Bundle
                    id: 5750238ea7fc204288bba7f7
                    meta:
                      lastUpdated: '2016-06-02T08:16:14-04:00'
                    type: message
                    entry:
                      - fullUrl: 'urn:uuid:e43cbbf0-11ed-4d65-b91a-f153d4067096'
                        resource:
                          _id: 5750238ea7fc204288bba7f8
                          data:
                            - external: false
                              reference: 'urn:uuid:ff483dfa-b959-4eff-8751-6c09634d27d4'
                          destination:
                            - endpoint: 'http://mitre.org/ptmatch'
                          event:
                            code: record-match
                            system: 'http://github.com/mitre/ptmatch/fhir/message-events'
                          resourceType: MessageHeader
                          response:
                            code: ok
                            identifier: 64af6aa4-0321-4516-843b-6d4514a56d3d
                          source:
                            endpoint: 'http://mitre.org/ptmatchadapter-fril'
                            name: FRIL - Equal Weight - Accept 60
                          timestamp:
                            precision: timestamp
                            time: '2016-06-02T08:16:14.343-04:00'
                      - fullUrl: 'urn:uuid:f3d647d9-536b-4ca8-aeaf-2099b077f36f'
                        resource:
                          _id: 5750238ea7fc204288bba7f9
                          issue:
                            - code: informational
                              details:
                                text: Deduplication Complete
                              severity: information
                          resourceType: OperationOutcome
                      - fullUrl: 'urn:uuid:ff483dfa-b959-4eff-8751-6c09634d27d4'
                        resource:
                          _id: ff483dfa-b959-4eff-8751-6c09634d27d4
                          parameter:
                            - name: type
                              valueString: master
                            - name: resourceType
                              valueString: Patient
                            - name: searchExpression
                              resource:
                                parameter:
                                  - name: resourceUrl
                                    valueString: 'http://localhost:3001/Patient'
                                  - name: gender
                                    valueString: MALE
                                  - name: address-city
                                    valueString: Grand Rapids
                                  - name: address-state
                                    valueString: MI
                                resourceType: Parameters
                          resourceType: Parameters
                      - link:
                          - relation: type
                            url: 'http://hl7.org/fhir/Patient'
                          - relation: related
                            url: 'http://localhost:3001/Patient/5733977ca291026adcf58526'
                        fullUrl: 'http://localhost:3001/Patient/56cc7f83a291024d6fd5e87f'
                        search:
                          extension:
                            - url: 'http://hl7.org/fhir/StructureDefinition/patient-mpi-match'
                              valueCode: probable
                          score: 0.71
                  receivedOn: '2016-06-02T08:16:14.381-04:00'
              metrics:
                f1: 1
                matchCount: 1
                falsePositiveCount: 1
              status:
                - message: 'Request Sent [201 Created]'
                  createdOn: '2016-06-02T08:15:50.725-04:00'
                - message: 'Response Received [5750238da7fc204288bba7f5]'
                  createdOn: '2016-06-02T08:16:13.432-04:00'
                - message: 'Metrics Updated [5750238da7fc204288bba7f5]'
                  createdOn: '2016-06-02T08:16:13.487-04:00'
                - message: 'Response Received [5750238ea7fc204288bba7f7]'
                  createdOn: '2016-06-02T08:16:14.381-04:00'
                - message: 'Metrics Updated [5750238ea7fc204288bba7f7]'
                  createdOn: '2016-06-02T08:16:14.397-04:00'
              matchingMode: deduplication
              recordMatchSystemInterfaceId: 572b66a7a291021cbcb5e0fa
              masterRecordSetId: 572b66b8a291021cbcb5e0fb

        400:
          description: Bad Request
        404:
          description: Not Found
    post:
      operationId: createRecordMatchRun
      summary: Create Record Match Run
      tags:
        - RecordMatchRun
      parameters:
        - name: body
          in: body
          description: Parameters for starting a Record Match Run
          required: true
          schema:
            $ref: '#/definitions/RecordMatchRunBase'
      responses:
        201:
          description: Resource Created
        400:
          description: Bad Request
        500:
          description: Internal Server Error

  /RecordMatchRun/{id}:
    get:
      operationId: getRecordMatchRunById
      summary: Get one Record Match Run by Id
      tags:
        - RecordMatchRun
      parameters:
        - name: id
          in: path
          description: resource identifier
          required: true
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchRun'
    put:
      operationId: updateRecordMatchRun
      summary: Update Record Match Run
      tags:
        - RecordMatchRun
      parameters:
        - name: id
          in: path
          description: resource identifier
          required: true
          type: string
        - name: recordMatchRun
          in: body
          description: Record Match Run to update
          required: true
          schema:
            $ref: '#/definitions/RecordMatchRunBase'
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchRun'
        400:
          description: Bad Request
        500:
          description: Internal Server Error
    delete:
      operationId: deleteRecordMatchRun
      summary: Delete Record Match Run
      tags:
        - RecordMatchRun
      parameters:
        - name: id
          in: path
          description: resource identifier
          required: true
          type: string
      responses:
        204:
          description: No Content
        500:
          description: Internal Server Error

  /RecordMatchRunMetrics:
    get:
      summary: Record Match Run Metrics
      tags:
        - RecordMatchRun
      responses:
        200:
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/RecordMatchRunMetrics'

  /RecordMatchSystemInterface:
    get:
      summary: Record Match System Interfaces
      tags:
        - RecordMatchSystemInterface
      responses:
        200:
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/RecordMatchSystemInterface'
        400:
          description: Bad Request
        404:
          description: Not Found
    post:
      operationId: createRecordMatchSystemInterface
      summary: Create Record Match System Interface
      tags:
        - RecordMatchSystemInterface
      parameters:
        - name: recordSystemInterface
          in: body
          description: Record System Interface to add
          required: true
          schema:
            $ref: '#/definitions/RecordMatchSystemInterfaceBase'
      responses:
        201:
          description: Resource Created
        400:
          description: Bad Request
        500:
          description: Internal Server Error

  /RecordMatchSystemInterface/{id}:
    get:
      operationId: getRecordMatchSystemInterfaceById
      summary: Get one Record Match System Interface by Id
      tags:
        - RecordMatchSystemInterface
      parameters:
        - name: id
          in: path
          description: Identifier of resource to fetch
          required: true
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchSystemInterface'
    put:
      operationId: updateRecordMatchSystemInterface
      summary: Update Record Match System Interface
      tags:
        - RecordMatchSystemInterface
      parameters:
        - name: id
          in: path
          description: Identifier of resource to update
          required: true
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordMatchSystemInterfaceBase'
        400:
          description: Bad Request
        500:
          description: Internal Server Error
    delete:
      operationId: deleteRecordMatchSystemInterface
      summary: Delete Record Match System Interface
      tags:
        - RecordMatchSystemInterface
      parameters:
        - name: id
          in: path
          description: Identifier of resource to delete
          required: true
          type: string
      responses:
        204:
          description: No Content
        500:
          description: Internal Server Error

  /RecordSet:
    get:
      operationId: getRecordSets
      summary: Get Record Sets
      tags:
        - RecordSet
      responses:
        200:
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/RecordSet'
        400:
          description: Bad Request
        404:
          description: Not Found
    post:
      operationId: createRecordSet
      summary: Create Record Set
      tags:
        - RecordSet
      parameters:
        - name: recordSet
          in: body
          description: Record Set to add
          required: true
          schema:
            $ref: '#/definitions/RecordSetBase'
      responses:
        201:
          description: Resource Created
        400:
          description: Bad Request
        500:
          description: Internal Server Error

  /RecordSet/{id}:
    get:
      operationId: getRecordSetById
      summary: Get one Record Set by Id
      tags:
        - RecordSet
      parameters:
        - name: id
          in: path
          description: Identifier of resource to fetch
          required: true
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordSet'
          examples:
            application/json:
              id: 572b66b8a291021cbcb5e0fb
              meta:
                createdOn: '2016-05-05T11:28:56.761-04:00'
                lastUpdatedOn: '2016-05-05T11:28:56.761-04:00'
              name: 'Males in Grand Rapids,MI'
              description: 'Male Patients with current address in Grand Rapids, MI'
              resourceType: Patient
              answerKey:
                resourceType: Bundle
                id: 541a72a8-df75-4484-ac89-ac4923f03b81
                meta:
                  lastUpdated: '2016-05-28T18:12:21-04:00'
                type: document
                entry:
                  - fullUrl: 'http://localhost:3001/Composition/180f219f-97a8-486d-99d9-ed631fe4fc57'
                    resource:
                      id: 180f219f-97a8-486d-99d9-ed631fe4fc57
                      attester:
                        - mode:
                            - professional
                          time: '2016-05-28T18:12:21-04:00'
                          party:
                            display: Good Health Clinic
                            external: false
                            reference: 'urn:uuid:b89450ff-31ae-46f7-a305-580a323b16be'
                            referenceid: 2.16.840.1.113883.19.5
                            type: Organization
                      author:
                        - display: Doctor Adam
                          external: false
                          reference: Practitioner/example
                          referenceid: example
                          type: Practitioner
                      confidentiality: 'N'
                      date:
                        precision: timestamp
                        time: '2016-02-01T07:30:02-05:00'
                      meta:
                        lastUpdated:
                          precision: timestamp
                          time: '2016-05-28T18:12:21-04:00'
                      resourceType: Composition
                      section:
                        - code:
                            coding:
                              - code: 10001-2
                                display: Matching Record
                                system: 'https://github.com/mitre/ptmatch'
                          entry:
                            - external: false
                              reference: 'http://localhost:3001/Patient/56d5a89ca2910241fb142603'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99ea'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56d5a89da2910241fb142626'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99e4'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99d5'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99e0'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56d5a89da2910241fb142627'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99d7'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56dda203a29102104bbf99d2'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56d5a89da2910241fb142617'
                            - external: false
                              reference: 'http://localhost:3001/Patient/56d5a89da2910241fb142618'
                          mode: final
                          title: Matching Records
                        - code:
                            coding:
                              - code: 10001-3
                                display: Record Set Description
                                system: 'https://github.com/mitre/ptmatch'
                          entry:
                            - external: false
                              reference: 'urn:uuid:b89450ff-31ae-46f7-a305-580a323b16be'
                          title: Record Set Description
                      status: final
                      subject:
                        display: Males in Grand Rapids Record Set
                        external: true
                        reference: 'http://localhost:3001/RecordSet/5730c7efa29102555425ab98'
                      title: Answer Key
                      type:
                        coding:
                          - code: 10001-1
                            system: 'https://github.com/mitre/ptmatch'
                        text: Collection of Matching Records
                  - fullUrl: 'http://localhost:3001/Practitioner/example'
                    resource:
                      id: example
                      identifier:
                        - system: 'http://www.acme.org/practitioners'
                          value: '23'
                      meta:
                        lastUpdated:
                          precision: timestamp
                          time: '2016-05-05T12:13:03-04:00'
                      name:
                        family:
                          - Careful
                        given:
                          - Adam
                        prefix:
                          - Dr
                      resourceType: Practitioner
                  - fullUrl: 'urn:uuid:b89450ff-31ae-46f7-a305-580a323b16be'
                    resource:
                      resourceType: Organization
                      id: 2.16.840.1.113883.19.5
                      text:
                        status: generated
                        div: |-
                          <div>

                           <p>Good Health Clinic</p>

                          </div>
                      identifier:
                        - system: 'urn:ietf:rfc:3986'
                          value: 2.16.840.1.113883.19.5
                      name: Good Health Clinic
                  - fullUrl: 'urn:uuid:b89450ff-31ae-46f7-a305-580a323b16be'
                    resource:
                      id: b89450ff-31ae-46f7-a305-580a323b16be
                      parameter:
                        - name: type
                          valueString: master
                        - name: resourceType
                          valueString: Patient
                        - name: searchExpression
                          resource:
                            parameter:
                              - name: resourceUrl
                                valueString: 'http://localhost:3001/Patient'
                              - name: gender
                                valueString: MALE
                              - name: address-city
                                valueString: Grand Rapids
                              - name: address-state
                                valueString: MI
                            resourceType: Parameters
                      resourceType: Parameters
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda163a29102104bbf9994'
                    fullUrl: 'http://localhost:3001/Patient/56d5a89ca2910241fb142603'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf9a0d'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99ea'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda164a29102104bbf99b7'
                    fullUrl: 'http://localhost:3001/Patient/56d5a89da2910241fb142626'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf9a07'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99e4'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf99f8'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99d5'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf9a03'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99e0'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda164a29102104bbf99b8'
                    fullUrl: 'http://localhost:3001/Patient/56d5a89da2910241fb142627'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf99fa'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99d7'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda249a29102104bbf99f5'
                    fullUrl: 'http://localhost:3001/Patient/56dda203a29102104bbf99d2'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda163a29102104bbf99a8'
                    fullUrl: 'http://localhost:3001/Patient/56d5a89da2910241fb142617'
                    search:
                      score: 1
                  - link:
                      - relation: type
                        url: 'http://hl7.org/fhir/Patient'
                      - relation: related
                        url: 'http://localhost:3001/Patient/56dda163a29102104bbf99a9'
                    fullUrl: 'http://localhost:3001/Patient/56d5a89da2910241fb142618'
                    search:
                      score: 1
                signature:
                  type:
                    - system: 'http://hl7.org/fhir/valueset-signature-type'
                      code: 1.2.840.10065.1.12.1.1
                      display: AuthorID
                  when: '2016-05-30T17:42:33-04:00'
                  whoReference:
                    reference: Device/software
                  contentType: image/jpg
                  blob: /9j/4AA Signature Blog goes here en//2Q==

    put:
      operationId: updateRecordSet
      summary: Update Record Set
      tags:
        - RecordSet
      parameters:
        - name: id
          in: path
          description: Identifier of resource to update
          required: true
          type: string
        - name: recordSet
          in: body
          description: Record Set to update
          required: true
          schema:
            $ref: '#/definitions/RecordSetBase'
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/RecordSet'
        400:
          description: Bad Request
        500:
          description: Internal Server Error
    delete:
      operationId: deleteRecordSet
      summary: Delete Record Set
      tags:
        - RecordSet
      parameters:
        - name: id
          in: path
          description: Identifier of resource to delete
          required: true
          type: string
      responses:
        204:
          description: No Content
        500:
          description: Internal Server Error

  # This is a path endpoint. Change it.
  /persons:
    # This is a HTTP operation
    get:
      # Describe this verb here. Note: you can use markdown
      description: |
        Gets `Person` objects.
        Optional query param of **size** determines
        size of returned array
      # This is array of GET operation parameters:
      parameters:
        # An example parameter that is in query and is required
        -
          name: size
          in: query
          description: Size of array
          required: true
          type: number
          format: double
      # Expected responses for this operation:
      responses:
        # Response code
        200:
          description: Successful response
          # A schema describing your response object.
          # Use JSON Schema format
          schema:
            title: ArrayOfPersons
            type: array
            items:
              title: Person
              type: object
              properties:
                name:
                  type: string
                single:
                  type: boolean

# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#                       Definitions
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
definitions:
  RecordMatchContextBase:
    type: object
    description: |
      A Record Match Context provides a way to group Record
      Match Runs that are related in some way.
    required:
    - name
    properties:
      name:
        type: string
      description:
        type: string
    example:
      name: Local FRIL; Grand Rapids Males; Team A
      description: Context for Team A; Objective 1

  RecordMatchContext:
    allOf:
    - $ref: '#/definitions/RecordMatchContextBase'
    - type: object
      required:
      - id
      properties:
        id:
          type: string
        meta:
          $ref: '#/definitions/Meta'

  RecordMatchRequest:
    type: object
    description: |
      A Record Match Context encapsulates the FHIR message
      generated to request a record match operation.
    required:
    - id
    - message
    - submittedOn
    properties:
      id:
        type: string
      meta:
        $ref: '#/definitions/Meta'
      message:
        $ref: '#/definitions/MessageBundle'
      submittedOn:
        type: string
        format: date-time
        description: date and time at which the message was sent to the record match system (via a FHIR server acting as a message broker.

  RecordMatchResponse:
    type: object
    required:
    - id
    - message
    - receivedOn
    properties:
      id:
        type: string
      meta:
        $ref: '#/definitions/Meta'
      message:
        $ref: '#/definitions/MessageBundle'
      receivedOn:
        type: string
        format: date-time
        description: date and time at which the message was received from the record match system (via a FHIR server acting as a message broker.

  RecordMatchRunBase:
    type: object
    description: |
      A Record Match Run encapsulates all data associated
      with a record match run, including the context, the
      generated request message, response messages, metrics,
      and status.
    required:
    - matchingMode
    - masterRecordSetId
    properties:
      matchingMode:
        type: string
        enum:
          - query
          - deduplication
        description: string literal, 'deduplication' or 'query'
      note:
        type: string
      recordMatchContextId:
        type: string
      recordMatchSystemInterfaceId:
        type: string
        minLength: 1
      masterRecordSetId:
        type: string
        minLength: 1
      queryRecordSetId:
        type: string
        minLength: 1
      recordResourceType:
        type: string
        enum:
        - Patient
    example:
      recordMatchContextId: 5746e836a291023b0db67629
      recordMatchSystemInterfaceId: 572b66a7a291021cbcb5e0fa
      matchingMode: deduplication
      masterRecordSetId: 572b66b8a291021cbcb5e0fb

  RecordMatchRun:
    allOf:
    - $ref: '#/definitions/RecordMatchRunBase'
    - type: object
      required:
      - id
      properties:
        id:
          type: string
        meta:
          $ref: '#/definitions/Meta'
        request:
          $ref: '#/definitions/RecordMatchRequest'
        responses:
          type: array
          items:
            $ref: '#/definitions/RecordMatchResponse'
        metrics:
          $ref: '#/definitions/RecordMatchRunMetrics'
        status:
          type: array
          items:
            $ref: '#/definitions/RecordMatchRunStatusComponent'

  RecordMatchRunMetrics:
    type: object
    properties:
      f1:
        type: number
        format: float
        minimum: 0
        maximum: 1
      precision:
        type: number
        format: float
        minimum: 0
        maximum: 1
      recall:
        type: number
        format: float
        minimum: 0
        maximum: 1
      MAP:
        type: number
        format: float
      matchCount:
        type: integer
        minimum: 0
      truePositiveCount:
        type: integer
        minimum: 0
      falsePositiveCount:
        type: integer
        minimum: 0

  RecordMatchSystemInterfaceBase:
    type: object
    required:
    - name
    - destinationEndpoint
    - responseEndpoint
    - serverEndpoint
    properties:
      name:
        type: string
      description:
        type: string
      destinationEndpoint:
        type: string
      responseEndpoint:
        type: string
      serverEndpoint:
        type: string

  RecordMatchSystemInterface:
    allOf:
    - $ref: '#/definitions/RecordMatchSystemInterfaceBase'
    - type: object
      required:
      - id
      properties:
        id:
          type: string
        meta:
          $ref: '#/definitions/Meta'

  RecordMatchRunStatusComponent:
    type: object
    required:
    - message
    - createdOn
    properties:
      message:
        type: string
      createdOn:
        type: string
        format: date-time
        description: date and time at which the status message was created

  RecordSetBase:
    type: object
    required:
    - name
    - resourceType
    - parameters
    properties:
      name:
        type: string
      description:
        type: string
      resourceType:
        type: string
        enum:
        - Patient
      answerKey:
        $ref: '#/definitions/AnswerKeyBundle'
      parameters:
        $ref: '#/definitions/RecordSetParameters'

  RecordSet:
    allOf:
    - $ref: '#/definitions/RecordSetBase'
    - type: object
      required:
      - id
      properties:
        id:
          type: string
        meta:
          $ref: '#/definitions/Meta'

  Meta:
    type: object
    properties:
      createdOn:
        description: date and time at which the resource was created.
        type: string
        format: date-time
      lastUpdatedOn:
        type: string
        format: date-time

  FhirBundle:
    type: object
    required:
      - id
      - resourceType
    externalDocs:
      description: FHIR Resource Bundle - Content
      url: https://www.hl7.org/fhir/bundle.html
    properties:
      id:
        type: string
        format: uuid
      resourceType:
        type: string
        enum:
        - Bundle
      entry:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          type: object
          required:
            - fullUrl
          properties:
            fhir_comments:
              type: array
              items:
                properties: {}
            fullUrl:
              type: string
              minLength: 1
            link:
              type: array
              uniqueItems: true
              minItems: 1
              items:
                required:
                  - relation
                  - url
                properties:
                  fhir_comments:
                    type: array
                    items:
                      properties: {}
                  relation:
                    type: string
                    minLength: 1
                  url:
                    type: string
                    minLength: 1
            resource:
              type: object
              properties:
                resourceType:
                  type: string
                  minLength: 1
                id:
                  type: string
                  minLength: 1
                text:
                  type: object
                  properties:
                    fhir_comments:
                      type: array
                      items:
                        properties: {}
                    status:
                      type: string
                      minLength: 1
                    div:
                      type: string
                      minLength: 1
                  required:
                    - status
                    - div
            search:
              type: object
              properties:
                fhir_comments:
                  type: array
                  items:
                    properties: {}
                mode:
                  type: string
                  minLength: 1
                _mode:
                  type: object
                  properties:
                    fhir_comments:
                      type: array
                      items:
                        properties: {}
                score:
                  type: number
                _score:
                  type: object
                  properties:
                    fhir_comments:
                      type: array
                      items:
                        properties: {}
              required:
                - mode
                - _mode
                - score
                - _score

  AnswerKeyBundle:
    type: object
    description: |
      An answer key specifies the links between matching records in the corresponding record set.  An answer key is represented as a FHIR Document, which is a FHIR Bundle with type, document.
    allOf:
    - $ref: '#/definitions/FhirBundle'
    - type: object
    properties:
      type:
        type: string
        enum:
        - document

  MessageBundle:
    type: object
    allOf:
    - $ref: '#/definitions/FhirBundle'
    - type: object
    properties:
      type:
        type: string
        enum:
        - message

  SearchExpressionParameters:
    allOf:
    - $ref: '#/definitions/Parameters'
    - type: object
    properties:
      parameter:
        type: array
        items:
          title: Parameter
          type: object
          required:
          - name
          properties:
            name:
              type: string
              enum:
              - resourceUrl
              - active
              - address
              - address-city
              - address-country
              - address-postalcode
              - address-state
              - address-use
              - animal-breed
              - animal-species
              - birthdate
              # careprovider - unsupported?
              - deathdate
              - deceased
              - email
              - family
              - gender
              - given
              - identifier
              - language
              #- link - unsupported?
              - name
              #- orgazniation - unsupported?
              - phone
              #- phonetic - unsupported?
              - telecom
            valueBoolean:
              type: boolean
            valueString:
              type: string
            valueToken:
              type: string
            valueInteger:
              type: integer

  Parameters:
    type: object
    properties:
      resourceType:
        type: string
        enum:
        - Parameters

  RecordSetParameters:
    allOf:
    - $ref: '#/definitions/Parameters'
    - type: object
    properties:
      parameter:
        type: array
        minItems: 1
        uniqueItems: true
        items:
          title: Parameter
          type: object
          required:
          - name
          properties:
            name:
              type: string
              enum:
              - type
              - resourceType
              - searchExpression
            valueString:
              type: string
              enum:
              - master
              - query
              - Patient
            resource:
              $ref: '#/definitions/SearchExpressionParameters'
